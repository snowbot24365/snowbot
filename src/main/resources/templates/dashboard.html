<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Snowbot Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .text-up { color: #dc3545; font-weight: bold; } /* 상승(빨강) */
        .text-down { color: #0d6efd; font-weight: bold; } /* 하락(파랑) */
        .card-header-custom { background-color: #f8f9fa; font-weight: 600; }
        .score-badge { font-size: 0.9em; }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><i class="fas fa-robot me-2"></i>Snowbot Dashboard</a>
        <div class="d-flex text-white">
            <span class="me-3"><i class="fas fa-coins me-1"></i>예수금: <span th:text="${#numbers.formatInteger(accountBalance, 0, 'COMMA')}">0</span>원</span>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <ul class="nav nav-tabs mb-3" id="dashboardTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="scoring-tab" data-bs-toggle="tab" data-bs-target="#scoring" type="button" role="tab"><i class="fas fa-star me-1"></i>Scoring Result</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="buying-tab" data-bs-toggle="tab" data-bs-target="#buying" type="button" role="tab"><i class="fas fa-cart-plus me-1"></i>Buying Process</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="portfolio-tab" data-bs-toggle="tab" data-bs-target="#portfolio" type="button" role="tab"><i class="fas fa-wallet me-1"></i>Portfolio</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab"><i class="fas fa-cog me-1"></i>Settings</button>
        </li>
    </ul>

    <div class="tab-content" id="dashboardTabContent">
        
        <div class="tab-pane fade show active" id="scoring" role="tabpanel">
            <div class="card shadow-sm">
                <div class="card-header card-header-custom">매수 대상 종목 (금일 스코어링 결과)</div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>종목명</th>
                                    <th>코드</th>
                                    <th>점수</th>
                                    <th>현재가</th>
                                    <th>날짜</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${scoringList}">
                                    <td th:text="${item.itemNm}" class="fw-bold">삼성전자</td>
                                    <td th:text="${item.itemCd}">005930</td>
                                    <td><span class="badge bg-success score-badge" th:text="${item.totalScore}">85</span></td>
                                    <td th:text="${#numbers.formatInteger(item.currentPrice, 0, 'COMMA')}">70,000</td>
                                    <td th:text="${item.date}">20231213</td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(scoringList)}">
                                    <td colspan="5" class="text-center py-4">금일 스코어링된 종목이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="buying" role="tabpanel">
            <div class="row g-3">
                <div class="col-md-4" th:each="buy : ${buyingList}">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-between">
                                <span th:text="${buy.itemNm}">SK하이닉스</span>
                                <small class="text-muted" th:text="${buy.itemCd}">000660</small>
                            </h5>
                            <p class="card-text mb-2">
                                현재 수량: <strong th:text="${buy.currentQty}">10</strong> / 
                                목표: <span th:text="${buy.targetQty}">100</span>
                            </p>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" 
                                     role="progressbar" 
                                     th:style="'width: ' + ${buy.progress} + '%'"
                                     th:text="${#numbers.formatDecimal(buy.progress, 0, 1)} + '%'">50%</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12" th:if="${#lists.isEmpty(buyingList)}">
                    <div class="alert alert-secondary text-center">현재 매수 진행 중인 종목이 없습니다.</div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="portfolio" role="tabpanel">
            <div class="card shadow-sm">
                <div class="card-header card-header-custom">보유 현황 및 수익률</div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>종목명 (코드)</th>
                                    <th class="text-end">평단가</th>
                                    <th class="text-end">현재가</th>
                                    <th class="text-center">보유수량</th>
                                    <th class="text-end">평가손익</th>
                                    <th class="text-end">수익률</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="pf : ${portfolioList}">
                                    <td>
                                        <strong th:text="${pf.itemNm}">NAVER</strong><br>
                                        <small class="text-muted" th:text="${pf.itemCd}">035420</small>
                                    </td>
                                    <td class="text-end" th:text="${#numbers.formatInteger(pf.avgPrice, 0, 'COMMA')}">200,000</td>
                                    <td class="text-end" th:text="${#numbers.formatInteger(pf.currentPrice, 0, 'COMMA')}">210,000</td>
                                    <td class="text-center"><span class="badge bg-secondary rounded-pill" th:text="${pf.qty}">50</span></td>
                                    <td class="text-end" 
                                        th:classappend="${pf.profitAmt > 0} ? 'text-up' : (${pf.profitAmt < 0} ? 'text-down' : '')"
                                        th:text="${#numbers.formatInteger(pf.profitAmt, 0, 'COMMA')}">500,000</td>
                                    <td class="text-end" 
                                        th:classappend="${pf.profitRate > 0} ? 'text-up' : (${pf.profitRate < 0} ? 'text-down' : '')"
                                        th:text="${#numbers.formatDecimal(pf.profitRate, 1, 2)} + '%'">5.00%</td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(portfolioList)}">
                                    <td colspan="6" class="text-center py-4">보유 중인 종목이 없습니다.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="settings" role="tabpanel">
            <div class="card shadow-sm border-warning">
                <div class="card-header bg-warning bg-opacity-10 text-dark fw-bold">
                    <i class="fas fa-exclamation-triangle me-1"></i> 트레이딩 설정 관리 (Read Only)
                </div>
                <div class="card-body">
                    <form>
                        <h6 class="border-bottom pb-2 mb-3">기본 매매 설정</h6>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Contract Rate (1회 매수 비율)</label>
                                <input type="text" class="form-control" th:value="${settings.contractRate}" readonly>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Limit Price (종목당 최대 한도)</label>
                                <input type="text" class="form-control" th:value="${#numbers.formatInteger(settings.limitPrice, 0, 'COMMA')}" readonly>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Limit Count (최대 보유 종목 수)</label>
                                <input type="text" class="form-control" th:value="${settings.limitCnt}" readonly>
                            </div>
                        </div>

                        <h6 class="border-bottom pb-2 mb-3 mt-4">매수 전략 (Buy)</h6>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Use YN (매수 사용 여부)</label>
                                <input type="text" class="form-control" th:value="${settings.buyUseYn}" 
                                       th:classappend="${settings.buyUseYn == 'Y'} ? 'bg-success text-white' : 'bg-secondary text-white'" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Test Force Buy</label>
                                <input type="text" class="form-control" th:value="${settings.testForceBuy}" readonly>
                            </div>
                        </div>

                        <h6 class="border-bottom pb-2 mb-3 mt-4">매도 전략 (Sell)</h6>
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label class="form-label">Up Rate (익절 %)</label>
                                <div class="input-group">
                                    <input type="text" class="form-control text-danger fw-bold" th:value="${settings.sellUpRate}" readonly>
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Down Rate (손절 %)</label>
                                <div class="input-group">
                                    <input type="text" class="form-control text-primary fw-bold" th:value="${settings.sellDownRate}" readonly>
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Hold Rate (매도 보류 비율)</label>
                                <input type="text" class="form-control" th:value="${settings.sellHoldRate}" readonly>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Use Loss Cut</label>
                                <input type="text" class="form-control" th:value="${settings.useLossCut}" readonly>
                            </div>
                        </div>
                    </form>
                    <p class="text-muted small mt-2">
                        * 현재 웹 화면에서의 설정 변경은 지원하지 않습니다. 변경이 필요한 경우 서버의 <code>application.yml</code> 파일을 수정 후 재시작하세요.
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>